{% extends 'base.html' %}

{% block title %}Supply Requests - Smart Supply Management System{% endblock %}

{% block content %}
<!-- Breadcrumbs & Header -->
<div class="mb-10 animate-fade-in-down">
    <nav class="flex mb-4 overflow-x-auto pb-2" aria-label="Breadcrumb">
        <ol class="flex items-center space-x-2 text-xs font-black uppercase tracking-widest whitespace-nowrap">
            <li><a href="{% url 'dashboard' %}" class="text-gray-500 hover:text-red-600 transition-colors">Dashboard</a></li>
            <li><i class="fas fa-chevron-right text-[10px] text-gray-400"></i></li>
            <li class="text-red-600">Supply Requests</li>
        </ol>
    </nav>
    <div class="flex flex-col md:flex-row md:items-end justify-between gap-4">
        <div>
            <h1 class="text-4xl md:text-5xl font-black text-gray-900 tracking-tighter mb-2">
                Supply <span class="text-red-600">Requests</span>
            </h1>
            <p class="text-gray-600 font-bold max-w-2xl">
                {% if user.role == 'admin' %}
                Complete oversight and management of all department equipment and material requests.
                {% elif user.role == 'gso_staff' %}
                Monitor, approve, and release requested items for laboratory and office use.
                {% else %}
                Track your active and historical requests for equipment and materials.
                {% endif %}
            </p>
        </div>
        {% if user.role == 'department_user' %}
        <div class="flex gap-3">
            <a href="{% url 'request_borrow_batch' %}"
                class="inline-flex items-center px-6 py-3 bg-red-600 text-white text-sm font-black rounded-2xl hover:bg-red-700 transition-all shadow-lg hover:shadow-red-200 hover:-translate-y-0.5 group">
                <i class="fas fa-layer-group mr-2 group-hover:rotate-12 transition-transform"></i>
                Batch Borrow
            </a>
            <a href="{% url 'request_create' %}"
                class="inline-flex items-center px-6 py-3 bg-gray-900 text-white text-sm font-black rounded-2xl hover:bg-black transition-all shadow-lg hover:-translate-y-0.5 group">
                <i class="fas fa-plus mr-2 group-hover:scale-110 transition-transform"></i>
                New Request
            </a>
        </div>
        {% endif %}
    </div>
</div>

<!-- Filters Section -->
<div class="glass-panel p-6 mb-8 border border-gray-100 shadow-sm animate-fade-in-up">
    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 items-end">
        <!-- Search -->
        <div class="md:col-span-2">
            <label class="block text-[10px] font-black text-gray-500 uppercase tracking-widest mb-2 ml-1">Search Requests</label>
            <div class="relative group">
                <input type="text" id="search" name="search" value="{{ search }}"
                    placeholder="Search by ID, supply name, or requester..."
                    class="w-full pl-12 pr-4 py-4 bg-gray-50 border border-gray-200 rounded-2xl focus:ring-2 focus:ring-red-600 focus:bg-white transition-all font-black outline-none"
                    hx-get="{% url 'request_list' %}" hx-trigger="keyup changed delay:500ms" hx-target="#request-list"
                    hx-include="#search, #status">
                <i class="fas fa-search absolute left-4 top-1/2 -translate-y-1/2 text-gray-400 group-focus-within:text-red-600 transition-colors"></i>
            </div>
        </div>

        <!-- Status Filter -->
        <div class="md:col-span-2">
            <label class="block text-[10px] font-black text-gray-500 uppercase tracking-widest mb-2 ml-1">Filter by Status</label>
            <div class="relative">
                <select id="status" name="status"
                    class="w-full px-4 py-4 bg-gray-50 border border-gray-200 rounded-2xl focus:ring-2 focus:ring-red-600 focus:bg-white transition-all font-black outline-none appearance-none cursor-pointer"
                    hx-get="{% url 'request_list' %}" hx-trigger="change" hx-target="#request-list"
                    hx-include="#search, #status">
                    <option value="">All Active Statuses</option>
                    <option value="pending" {% if status_filter == 'pending' %}selected{% endif %}>Pending Approval</option>
                    <option value="approved" {% if status_filter == 'approved' %}selected{% endif %}>Ready for Pickup</option>
                    <option value="released" {% if status_filter == 'released' %}selected{% endif %}>Currently Borrowed</option>
                    <option value="returned" {% if status_filter == 'returned' %}selected{% endif %}>Fully Returned</option>
                    <option value="partially_returned" {% if status_filter == 'partially_returned' %}selected{% endif %}>Partially Returned</option>
                    <option value="returned_with_issues" {% if status_filter == 'returned_with_issues' %}selected{% endif %}>Returned (With Issues)</option>
                    <option value="rejected" {% if status_filter == 'rejected' %}selected{% endif %}>Rejected / Denied</option>
                </select>
                <i class="fas fa-chevron-down absolute right-4 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none"></i>
            </div>
        </div>
    </div>
</div>

<!-- Request List -->
<div id="request-list">
    {% include 'inventory/partials/request_list.html' %}
</div>
{% endblock %}